
drop program zzz_create_cust_table:dba go
create program zzz_create_cust_table:dba

	select into "nl:"
		table_name
	from all_tables
	where table_name = "ZZZ_CUSTOM_RECORD_MAIN"
	with nocounter

	if (curqual = 0)
		call echo("Creating table ZZZ_CUSTOM_RECORD_MAIN")
		RDB CREATE TABLE ZZZ_CUSTOM_RECORD_MAIN (
			RECORD_MAIN_ID NUMBER NOT NULL,
      		RPT_INSTANCE_ID NUMBER NULL,
			SCHEDULE_ID NUMBER NULL,
			ENCNTR_ID NUMBER NULL,
			PERSON_ID NUMBER NULL,
			EPISODE_ID NUMBER NULL,
			REFERRAL_ID_VALUE_TXT VARCHAR2(100) NULL,
			MSG_ID_VALUE_TXT VARCHAR2(100) NULL,
			BATCH_ID_VALUE_TXT VARCHAR2(100) NULL,
			RECORD_OUTCOME_TXT VARCHAR2(1) NULL,
			INFO_NUM1_VALUE NUMBER NULL,
			INFO_NUM2_VALUE NUMBER NULL,
			INFO_CHAR1_TXT VARCHAR2(250) NULL,
			INFO_CHAR2_TXT VARCHAR2(250) NULL,
			UPDT_DT_TM DATE NOT NULL,
			UPDT_ID NUMBER NOT NULL,
			UPDT_TASK NUMBER NOT NULL,
			UPDT_APPLCTX NUMBER NOT NULL,
			UPDT_CNT NUMBER NOT NULL
		) END

		RDB CREATE UNIQUE INDEX XPK_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (RECORD_MAIN_ID) END
    	RDB CREATE INDEX XAK102_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (RECORD_MAIN_ID, RPT_INSTANCE_ID) END
		RDB CREATE INDEX XAK103_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (PERSON_ID) END
		RDB CREATE INDEX XAK104_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (ENCNTR_ID) END
		RDB CREATE INDEX XAK105_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (EPISODE_ID) END
		RDB CREATE INDEX XAK106_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (SCHEDULE_ID) END
		RDB CREATE INDEX XAK107_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (INFO_NUM1_VALUE) END
		RDB CREATE INDEX XAK108_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (INFO_NUM2_VALUE) END
		RDB CREATE INDEX XAK109_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (PERSON_ID, SCHEDULE_ID) END
		RDB CREATE INDEX XAK110_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (EPISODE_ID, REFERRAL_ID_VALUE_TXT) END
		RDB CREATE INDEX XAK111_ZZZ_CUSTOM_RECORD_MAIN ON ZZZ_CUSTOM_RECORD_MAIN (MSG_ID_VALUE_TXT) END

		RDB CREATE SEQUENCE V500.ZZZ_CUSTOM_RECORD_MAIN_SEQ
					START WITH 1
					INCREMENT BY 1
					NOCYCLE
					NOCACHE end

		RDB CREATE PUBLIC SYNONYM ZZZ_CUSTOM_RECORD_MAIN_SEQ FOR V500.ZZZ_CUSTOM_RECORD_MAIN_SEQ END
		RDB  CREATE  PUBLIC  SYNONYM  ZZZ_CUSTOM_RECORD_MAIN  FOR  ZZZ_CUSTOM_RECORD_MAIN  END
	else
		;Add new columns that did not exist before
		call echo("Skipping create table ZZZ_CUSTOM_RECORD_MAIN")

		select into "nl:"
			column_name
		from all_tab_columns
		where table_name = "ZZZ_CUSTOM_RECORD_MAIN"
		and column_name IN ("RPT_CREATE_DT_TM", "RPT_CREATE_BY_ID")
		with nocounter

		if (curqual = 0)
			call echo("Altering table ZZZ_CUSTOM_RECORD_MAIN adding INFO_CHAR1_TXT and INFO_CHAR2_TXT Columns")
			RDB ALTER TABLE ZZZ_CUSTOM_RECORD_MAIN ADD (INFO_CHAR1_TXT VARCHAR2(250) NULL, INFO_CHAR2_TXT VARCHAR2(250) NULL) end
		else
			call echo("Skipping alter table ZZZ_CUSTOM_RECORD_MAIN adding INFO_CHAR1_TXT and INFO_CHAR2_TXT Columns")
		endif
	endif

	drop table ZZZ_CUSTOM_RECORD_MAIN
	execute oragen3 "ZZZ_CUSTOM_RECORD_MAIN"

end
go
